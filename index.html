<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bahamas Store | Cloud Edition</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --primary: #FFD700; --bg-body: #0d0f12; --bg-card: #16191f; --bg-darker: #08090b; }
        body { background-color: var(--bg-body); color: white; font-family: 'Montserrat', sans-serif; }
        .navbar { background: var(--bg-card); border-bottom: 2px solid var(--primary); }
        .navbar-brand { font-weight: 800; color: var(--primary) !important; }
        .view { display: none; }
        .view.active { display: block; }

        /* Estilo das Categorias no Topo */
        .category-container { background: var(--bg-darker); padding: 10px 0; border-bottom: 1px solid #222; }
        .category-scroll { display: flex; gap: 10px; overflow-x: auto; white-space: nowrap; scrollbar-width: none; }
        .category-scroll::-webkit-scrollbar { display: none; }
        
        .cat-btn { 
            background: #1f232b; color: white; border: 1px solid #333; 
            padding: 8px 20px; border-radius: 50px; cursor: pointer; 
            font-weight: 600; transition: 0.3s;
        }
        .cat-btn.active { background: var(--primary); color: #000; border-color: var(--primary); box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }

        /* Cards */
        .img-container { width: 100%; height: 160px; overflow: hidden; background: #222; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        .prod-card { background: var(--bg-card); border-radius: 12px; border: 1px solid #2d3139; overflow: hidden; transition: 0.3s; height: 100%; }
        .prod-card:hover { border-color: var(--primary); transform: translateY(-5px); }

        .cart-btn { position: fixed; bottom: 25px; right: 25px; background: var(--primary); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; z-index: 2000; color: #000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showView('store')">BAHAMAS STORE</a>
            <button class="btn btn-sm btn-outline-warning" onclick="accessAdmin()"><i class="fas fa-cog"></i> PAINEL</button>
        </div>
    </nav>

    <div id="view-store" class="view active">
        <div class="category-container">
            <div class="container">
                <div class="category-scroll" id="cat-list">
                    </div>
            </div>
        </div>

        <div class="container py-4">
            <div class="row g-4" id="prod-grid"></div>
            
            <h5 class="fw-bold mt-5 mb-3 text-warning"><i class="fas fa-star"></i> Feedback dos Clientes</h5>
            <div id="review-list" class="row g-3"></div>
        </div>
    </div>

    <div id="view-admin" class="view container py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-warning fw-bold">Dashboard Bahamas</h2>
            <button class="btn btn-danger btn-sm" onclick="showView('store')">Sair do Painel</button>
        </div>

        <div class="row g-3">
            <div class="col-md-4">
                <div class="bg-card p-3 rounded border border-secondary">
                    <h5 class="mb-3">Adicionar Novo Item</h5>
                    <input type="text" id="p-name" class="form-control bg-dark text-white mb-2" placeholder="Nome do Produto">
                    <input type="number" id="p-price" class="form-control bg-dark text-white mb-2" placeholder="PreÃ§o (Ex: 50)">
                    <input type="text" id="p-cat" class="form-control bg-dark text-white mb-2" placeholder="Categoria (Ex: Carros, VIPs)">
                    <input type="text" id="p-img" class="form-control bg-dark text-white mb-2" placeholder="Link da Imagem">
                    <button class="btn btn-warning w-100 fw-bold" onclick="saveProduct()">CADASTRAR NO BANCO</button>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="bg-card p-3 rounded border border-secondary">
                    <h5 class="mb-3">Itens Ativos (Nuvem)</h5>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead><tr><th>Nome</th><th>Categoria</th><th>PreÃ§o</th><th>AÃ§Ã£o</th></tr></thead>
                            <tbody id="adm-table-prods"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="cart-btn" onclick="openCart()"><i class="fas fa-shopping-basket"></i><span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        // SUA CONFIGURAÃ‡ÃƒO QUE VOCÃŠ ENVIOU
        const firebaseConfig = {
            apiKey: "AIzaSyCYzx7TPmAghFcGuKYzBDIYRW0SjrMJ_r8",
            authDomain: "quebrei-o-sistema.firebaseapp.com",
            databaseURL: "https://quebrei-o-sistema-default-rtdb.firebaseio.com",
            projectId: "quebrei-o-sistema",
            storageBucket: "quebrei-o-sistema.firebasestorage.app",
            messagingSenderId: "133672006102",
            appId: "1:133672006102:web:e62c681ced44b3650f7477"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let storeData = { prods: {} };
        let cart = [];

        // --- PUXAR DADOS EM TEMPO REAL ---
        onValue(ref(db, 'store'), (snapshot) => {
            const data = snapshot.val();
            if (data) {
                storeData = data;
                renderStore();
                renderAdmin();
            }
        });

        // --- LÃ“GICA DA LOJA ---
        window.showView = (v) => {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
        };

        window.renderStore = (filter = 'Todos') => {
            const prods = storeData.prods ? Object.values(storeData.prods) : [];
            
            // Gerar lista de categorias Ãºnica baseada nos produtos existentes
            const uniqueCats = ['Todos', ...new Set(prods.map(p => p.cat).filter(c => c))];
            const catList = document.getElementById('cat-list');
            catList.innerHTML = uniqueCats.map(c => `
                <div class="cat-btn ${filter === c ? 'active' : ''}" onclick="renderStore('${c}')">
                    ${c}
                </div>
            `).join('');

            const grid = document.getElementById('prod-grid');
            const filtered = filter === 'Todos' ? prods : prods.filter(p => p.cat === filter);
            
            grid.innerHTML = filtered.map(p => `
                <div class="col-6 col-md-4 col-lg-3">
                    <div class="prod-card">
                        <div class="img-container"><img src="${p.img || 'https://via.placeholder.com/200'}" onerror="this.src='https://via.placeholder.com/200'"></div>
                        <div class="p-3">
                            <h6 class="fw-bold mb-1 small">${p.name}</h6>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-primary fw-bold">R$ ${p.price}</span>
                                <button class="btn btn-sm btn-warning" onclick="addToCart('${p.id}')">+</button>
                            </div>
                        </div>
                    </div>
                </div>`).join('');
        };

        window.saveProduct = () => {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const cat = document.getElementById('p-cat').value || 'Geral';
            const img = document.getElementById('p-img').value;

            if(name && price) {
                const newKey = push(ref(db, 'store/prods')).key;
                set(ref(db, `store/prods/${newKey}`), { id: newKey, name, price, cat, img });
                // Limpar campos
                document.getElementById('p-name').value = '';
                document.getElementById('p-price').value = '';
                Swal.fire('Sucesso', 'Produto salvo na nuvem!', 'success');
            } else {
                Swal.fire('Erro', 'Nome e PreÃ§o sÃ£o obrigatÃ³rios', 'error');
            }
        };

        window.deleteItem = (id) => {
            remove(ref(db, `store/prods/${id}`));
        };

        window.renderAdmin = () => {
            const table = document.getElementById('adm-table-prods');
            const prods = storeData.prods ? Object.values(storeData.prods) : [];
            table.innerHTML = prods.map(p => `
                <tr>
                    <td>${p.name}</td>
                    <td><span class="badge bg-secondary">${p.cat}</span></td>
                    <td>R$ ${p.price}</td>
                    <td><button class="btn btn-sm btn-danger" onclick="deleteItem('${p.id}')">Excluir</button></td>
                </tr>
            `).join('');
        };

        window.accessAdmin = () => {
            Swal.fire({ title: 'Senha ADM', input: 'password' }).then(r => {
                if(r.value === '2707') showView('admin');
            });
        };

        window.addToCart = (id) => {
            cart.push(storeData.prods[id]);
            document.getElementById('cart-badge').innerText = cart.length;
        };

        window.openCart = () => {
            const total = cart.reduce((a, b) => a + parseFloat(b.price), 0);
            Swal.fire({
                title: 'Carrinho',
                background: '#16191f', color: '#fff',
                html: cart.map(i => `<div class="d-flex justify-content-between border-bottom border-secondary py-1"><span>${i.name}</span><b>R$ ${i.price}</b></div>`).join('') + `<h4 class="mt-3 text-warning">Total: R$ ${total.toFixed(2)}</h4>`,
                confirmButtonText: 'Finalizar no Discord'
            }).then(r => {
                if(r.isConfirmed && cart.length > 0) {
                    const msg = `ðŸ›’ **PEDIDO BAHAMAS**\n` + cart.map(i => `â€¢ ${i.name}`).join('\n') + `\nðŸ’° **TOTAL:** R$ ${total.toFixed(2)}`;
                    navigator.clipboard.writeText(msg);
                    window.open('https://discord.gg/uV3XzeWAtb', '_blank');
                    cart = []; document.getElementById('cart-badge').innerText = 0;
                }
            });
        };

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
