<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Loja Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
--bg:#0d0d0d;
--card:#161616;
--accent:#00ff88;
--text:#eaeaea;
}

body{margin:0;font-family:Arial;background:var(--bg);color:var(--text)}
header{background:#000;padding:15px;display:flex;justify-content:space-between}
button{padding:8px;border:none;border-radius:5px;cursor:pointer}
.container{max-width:1200px;margin:auto;padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px}
.card{background:var(--card);padding:15px;border-radius:8px}
h2,h3{color:var(--accent)}
input{width:100%;padding:8px;margin-top:5px;background:#222;color:#fff;border:none;border-radius:5px}
.hidden{display:none}
.delete{background:#ff4444;margin-top:5px}
</style>
</head>

<body>

<header>
  <strong>üõí Minha Loja</strong>
  <button onclick="abrirAdmin()">Admin</button>
</header>

<!-- ================= LOJA ================= -->
<div id="loja" class="container">

<h2>Avisos</h2>
<div id="avisos"></div>

<h2>Categorias</h2>
<div id="categorias" class="grid"></div>

<h2>Produtos</h2>
<div id="produtos" class="grid"></div>

<h2>Avalia√ß√µes</h2>
<div id="avaliacoes"></div>

</div>

<!-- ================= ADMIN ================= -->
<div id="admin" class="container hidden">

<div id="login" class="card">
<h2>Login Admin</h2>
<input id="senha" type="password" placeholder="Senha">
<button onclick="loginSenha()">Entrar</button>
<hr>
<button onclick="loginGoogle()">Google</button>
</div>

<div id="painel" class="hidden">

<button onclick="fecharAdmin()">Voltar √† loja</button>

<div class="card">
<h3>Categorias</h3>
<input id="cat"><button onclick="add('categorias',{nome:cat.value})">Add</button>
<div id="listaCategorias"></div>
</div>

<div class="card">
<h3>Produtos</h3>
<input id="pn" placeholder="Nome">
<input id="pp" placeholder="Pre√ßo">
<input id="pc" placeholder="Categoria">
<button onclick="add('produtos',{nome:pn.value,preco:pp.value,categoria:pc.value})">Add</button>
<div id="listaProdutos"></div>
</div>

<div class="card">
<h3>Cupons</h3>
<input id="cn" placeholder="C√≥digo">
<input id="cv" placeholder="%">
<button onclick="add('cupons',{codigo:cn.value,desconto:cv.value})">Add</button>
<div id="listaCupons"></div>
</div>

<div class="card">
<h3>Avisos</h3>
<input id="av">
<button onclick="add('avisos',{texto:av.value})">Add</button>
<div id="listaAvisos"></div>
</div>

<div class="card">
<h3>Avalia√ß√µes</h3>
<input id="an" placeholder="Nome">
<input id="ant" placeholder="Nota">
<input id="at" placeholder="Coment√°rio">
<button onclick="add('avaliacoes',{nome:an.value,nota:ant.value,texto:at.value})">Add</button>
<div id="listaAvaliacoes"></div>
</div>

</div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
 apiKey:"AIzaSyCYzx7TPmAghFcGuKYzBDIYRW0SjrMJ_r8",
 databaseURL:"https://quebrei-o-sistema-default-rtdb.firebaseio.com",
 projectId:"quebrei-o-sistema"
});
const db=firebase.database(),auth=firebase.auth();

/* LOJA */
db.ref("avisos").on("value",s=>{
 avisos.innerHTML="";
 s.forEach(i=>avisos.innerHTML+=`<div class=card>${i.val().texto}</div>`);
});
db.ref("categorias").on("value",s=>{
 categorias.innerHTML="";
 s.forEach(i=>categorias.innerHTML+=`<div class=card>${i.val().nome}</div>`);
});
db.ref("produtos").on("value",s=>{
 produtos.innerHTML="";
 s.forEach(i=>{
  let p=i.val();
  produtos.innerHTML+=`<div class=card><h3>${p.nome}</h3><p>R$ ${p.preco}</p><small>${p.categoria}</small></div>`;
 });
});
db.ref("avaliacoes").on("value",s=>{
 avaliacoes.innerHTML="";
 s.forEach(i=>{
  let a=i.val();
  avaliacoes.innerHTML+=`<div class=card>‚≠ê ${a.nota} - ${a.nome}<br>${a.texto}</div>`;
 });
});

/* ADMIN */
function abrirAdmin(){loja.classList.add("hidden");admin.classList.remove("hidden")}
function fecharAdmin(){admin.classList.add("hidden");loja.classList.remove("hidden")}

function loginSenha(){
 if(senha.value==="270712"){login.classList.add("hidden");painel.classList.remove("hidden");listarTudo();}
 else alert("Senha errada");
}
function loginGoogle(){
 auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
 .then(()=>{login.classList.add("hidden");painel.classList.remove("hidden");listarTudo();});
}

function add(p,o){db.ref(p).push(o)}

function listar(p,el){
 db.ref(p).on("value",s=>{
  el.innerHTML="";
  s.forEach(i=>{
   let d=document.createElement("div");
   d.className="card";
   d.textContent=JSON.stringify(i.val());
   let b=document.createElement("button");
   b.textContent="Remover";
   b.className="delete";
   b.onclick=()=>db.ref(p+"/"+i.key).remove();
   d.appendChild(b);
   el.appendChild(d);
  });
 });
}
function listarTudo(){
 listar("categorias",listaCategorias);
 listar("produtos",listaProdutos);
 listar("cupons",listaCupons);
 listar("avisos",listaAvisos);
 listar("avaliacoes",listaAvaliacoes);
}
</script>

</body>
</html>
