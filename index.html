<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUEBREI O SISTEMA | Pro Admin Hub</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root { 
            --primary: #00ff88; --secondary: #007bff; --bg: #02010a; 
            --glass: rgba(255, 255, 255, 0.05); --danger: #ff4d4d; --warning: #f39c12;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; transition: 0.3s; }
        body { font-family: 'Segoe UI', sans-serif; background: #02010a; color: white; min-height: 100vh; overflow-x: hidden; }

        /* Estrelas Animadas */
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.3; z-index: -1; animation: moveStars 120s linear infinite; }
        @keyframes moveStars { from {background-position: 0 0;} to {background-position: 1000px 1000px;} }

        /* UI Base */
        header { background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); padding: 15px 8%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 1000; }
        .nav-link { color: #888; text-decoration: none; font-weight: bold; cursor: pointer; margin: 0 15px; font-size: 0.8rem; text-transform: uppercase; }
        .nav-link.active { color: var(--primary); }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

        /* Admin UI */
        #admin-panel { display: none; background: rgba(5, 5, 5, 0.95); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; overflow-y: auto; }
        .admin-sidebar { width: 250px; background: #000; height: 100vh; position: fixed; border-right: 1px solid #222; padding: 20px; }
        .admin-content { margin-left: 250px; padding: 40px; }
        .adm-nav-item { padding: 15px; cursor: pointer; border-radius: 8px; margin-bottom: 5px; color: #777; font-weight: bold; }
        .adm-nav-item:hover, .adm-nav-item.active { background: var(--glass); color: var(--primary); }

        /* Bot√µes e Inputs */
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; color: white; display: flex; align-items: center; gap: 10px; }
        .btn-primary { background: var(--secondary); }
        .btn-danger { background: var(--danger); }
        input, select, textarea { background: #111; border: 1px solid #333; color: white; padding: 12px; border-radius: 6px; width: 100%; margin-bottom: 15px; outline: none; }
        
        /* Cards */
        .card { background: var(--glass); border: 1px solid #222; border-radius: 12px; padding: 20px; }
        .table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .table th, .table td { padding: 15px; text-align: left; border-bottom: 1px solid #222; }

        /* Notifica√ß√µes */
        #notif { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
        .toast { background: #111; border-left: 5px solid var(--primary); padding: 15px 25px; margin-bottom: 10px; animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        section { display: none; }
        section.active { display: block; }
    </style>
</head>
<body>

<div class="stars"></div>
<div id="notif"></div>

<header id="main-header">
    <div style="font-weight:900; letter-spacing:1px;">QUEBREI O <span style="color:var(--secondary)">SISTEMA</span></div>
    <nav>
        <a class="nav-link active" onclick="showTab('store')">Loja</a>
        <a class="nav-link" onclick="showTab('community')">Comunidade</a>
        <a class="nav-link" onclick="showTab('help')">Suporte</a>
    </nav>
    <div id="user-area">
        <button class="btn btn-primary" onclick="login()">LOGIN GMAIL</button>
    </div>
</header>

<div class="container" id="public-content">
    <section id="store" class="active">
        <div id="store-grid" class="grid"></div>
    </section>
    
    <section id="community">
        <div class="card" style="height: 500px; display: flex; flex-direction: column;">
            <div id="chat-box" style="flex:1; overflow-y:auto; padding:10px;"></div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="text" id="chat-input" placeholder="Conversar...">
                <button class="btn btn-primary" onclick="sendMessage()">ENVIAR</button>
            </div>
        </div>
    </section>

    <section id="help">
        <div class="card" style="max-width: 600px; margin: auto; text-align: center;">
            <i class="fas fa-headset fa-3x" style="color:var(--primary)"></i>
            <h2>Central de Suporte</h2>
            <p>Precisa de ajuda? Abra um ticket abaixo.</p>
            <textarea id="ticket-msg" placeholder="Descreva seu problema..." style="margin-top:20px;"></textarea>
            <button class="btn btn-primary" style="width:100%" onclick="openTicket()">ABRIR TICKET AGORA</button>
        </div>
    </section>
</div>

<div id="admin-panel">
    <div class="admin-sidebar">
        <h2 style="color:var(--primary); margin-bottom:30px;">ADM PANEL</h2>
        <div class="adm-nav-item active" onclick="showAdmTab('adm-dash')"><i class="fas fa-chart-line"></i> Dashboard</div>
        <div class="adm-nav-item" onclick="showAdmTab('adm-products')"><i class="fas fa-box"></i> Produtos</div>
        <div class="adm-nav-item" onclick="showAdmTab('adm-tickets')"><i class="fas fa-ticket-alt"></i> Tickets</div>
        <div class="adm-nav-item" onclick="showAdmTab('adm-carts')"><i class="fas fa-shopping-cart"></i> Carrinhos</div>
        <div class="adm-nav-item" style="color:var(--danger); margin-top:50px;" onclick="closeAdmin()"><i class="fas fa-times"></i> Sair</div>
    </div>

    <div class="admin-content">
        <section id="adm-dash" class="active">
            <h1>Vis√£o Geral</h1>
            <div class="grid" style="margin-top:20px;">
                <div class="card"><h4>Vendas Totais</h4><h2 id="stat-sales">R$ 0,00</h2></div>
                <div class="card"><h4>Tickets Abertos</h4><h2 id="stat-tickets">0</h2></div>
            </div>
        </section>

        <section id="adm-products">
            <h1>Gerenciar Loja</h1>
            <div class="card" style="margin-top:20px;">
                <h3>Criar / Editar Produto</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
                    <input type="text" id="p-name" placeholder="Nome">
                    <input type="number" id="p-price" placeholder="Pre√ßo">
                    <input type="text" id="p-img" placeholder="Link da Imagem">
                    <input type="text" id="p-cat" placeholder="Categoria">
                </div>
                <button class="btn btn-primary" onclick="saveProduct()">SALVAR PRODUTO</button>
            </div>
            <table class="table" id="table-products">
                <thead><tr><th>Nome</th><th>Pre√ßo</th><th>Cat</th><th>A√ß√µes</th></tr></thead>
                <tbody id="list-adm-products"></tbody>
            </table>
        </section>

        <section id="adm-tickets">
            <h1>Tickets dos Usu√°rios</h1>
            <div id="list-adm-tickets"></div>
        </section>

        <section id="adm-carts">
            <h1>Logs de Carrinhos</h1>
            <p>Monitore o que os usu√°rios est√£o clicando em "Comprar".</p>
            <div id="list-adm-carts" style="margin-top:20px;"></div>
        </section>
    </div>
</div>

<footer style="text-align:center; padding:50px; opacity:0.1; cursor:pointer;" onclick="checkAdmin()">ADM</footer>

<script>
    // CONFIGURA√á√ÉO
    const firebaseConfig = {
        apiKey: "AIzaSyCYzx7TPmAghFcGuKYzBDIYRW0SjrMJ_r8",
        authDomain: "quebrei-o-sistema.firebaseapp.com",
        databaseURL: "https://quebrei-o-sistema-default-rtdb.firebaseio.com",
        projectId: "quebrei-o-sistema",
        appId: "1:133672006102:web:e62c681ced44b3650f7477"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let user = null;

    // CORE UI
    function toast(m) {
        const t = document.createElement('div'); t.className='toast'; t.innerText=m;
        document.getElementById('notif').appendChild(t);
        setTimeout(()=>t.remove(), 3000);
    }

    function showTab(id) {
        document.querySelectorAll('#public-content section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
    }

    function showAdmTab(id) {
        document.querySelectorAll('.admin-content section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.adm-nav-item').forEach(l => l.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
    }

    // LOGIN
    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).then(res => {
            user = res.user;
            document.getElementById('user-area').innerHTML = `<img src="${user.photoURL}" style="width:35px; border-radius:50%; border:2px solid var(--primary)">`;
            toast("Bem-vindo!");
        });
    }

    // ADMIN AUTH
    function checkAdmin() {
        const pass = prompt("Chave Mestra:");
        if(pass === "270712") {
            document.getElementById('admin-panel').style.display = 'block';
            loadAdminData();
        } else {
            toast("Acesso negado.");
        }
    }
    function closeAdmin() { document.getElementById('admin-panel').style.display = 'none'; }

    // GEST√ÉO DE PRODUTOS
    function saveProduct() {
        const p = {
            name: document.getElementById('p-name').value,
            price: document.getElementById('p-price').value,
            img: document.getElementById('p-img').value,
            cat: document.getElementById('p-cat').value
        };
        db.ref('produtos').push(p);
        toast("Produto salvo com sucesso!");
    }

    db.ref('produtos').on('value', snap => {
        const grid = document.getElementById('store-grid');
        const admList = document.getElementById('list-adm-products');
        grid.innerHTML = ""; admList.innerHTML = "";
        
        snap.forEach(child => {
            const data = child.val();
            const id = child.key;
            
            // Loja
            grid.innerHTML += `<div class="card">
                ${data.img ? `<img src="${data.img}" style="width:100%; height:150px; object-fit:contain;">` : '<div style="height:150px; font-size:3rem; text-align:center">üì¶</div>'}
                <h3>${data.name}</h3>
                <p style="color:var(--primary)">R$ ${data.price}</p>
                <button class="btn btn-primary" style="width:100%; margin-top:10px" onclick="addToCart('${data.name}')">COMPRAR</button>
            </div>`;

            // Tabela Adm
            admList.innerHTML += `<tr>
                <td>${data.name}</td>
                <td>R$ ${data.price}</td>
                <td>${data.cat}</td>
                <td><button class="btn btn-danger" onclick="db.ref('produtos/${id}').remove()">Excluir</button></td>
            </tr>`;
        });
    });

    // SISTEMA DE TICKETS
    function openTicket() {
        if(!user) return toast("Fa√ßa login antes!");
        const msg = document.getElementById('ticket-msg').value;
        db.ref('tickets').push({
            uid: user.uid,
            userName: user.displayName,
            msg: msg,
            status: 'aberto',
            date: new Date().toLocaleString()
        });
        document.getElementById('ticket-msg').value = "";
        toast("Ticket enviado!");
    }

    // SISTEMA DE CARRINHO (LOGS)
    function addToCart(pName) {
        if(!user) return toast("Fa√ßa login para comprar!");
        db.ref('carrinhos').push({
            user: user.displayName,
            product: pName,
            time: new Date().toLocaleTimeString()
        });
        toast("Adicionado ao carrinho!");
    }

    // CARREGAR DADOS ADM
    function loadAdminData() {
        // Tickets
        db.ref('tickets').on('value', snap => {
            const list = document.getElementById('list-adm-tickets');
            document.getElementById('stat-tickets').innerText = snap.numChildren();
            list.innerHTML = "";
            snap.forEach(child => {
                const t = child.val();
                list.innerHTML += `<div class="card" style="margin-bottom:10px;">
                    <b>${t.userName}</b> - <small>${t.date}</small>
                    <p style="margin:10px 0;">${t.msg}</p>
                    <button class="btn btn-primary" onclick="db.ref('tickets/${child.key}').remove()">Fechar Ticket</button>
                </div>`;
            });
        });

        // Carrinhos (Logs)
        db.ref('carrinhos').limitToLast(10).on('value', snap => {
            const list = document.getElementById('list-adm-carts');
            list.innerHTML = "";
            snap.forEach(child => {
                const c = child.val();
                list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222;">
                    üü¢ <b>${c.user}</b> clicou em <b>${c.product}</b> √†s ${c.time}
                </div>`;
            });
        });
    }

    AOS.init();
</script>
</body>
</html>
