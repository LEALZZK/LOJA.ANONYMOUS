<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUEBREI O SISTEMA | Hub V4</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root { 
            --primary: #00ff88; --secondary: #007bff; --bg: #02010a; 
            --glass: rgba(255, 255, 255, 0.05); --danger: #ff4d4d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; transition: 0.3s; }
        body { font-family: 'Segoe UI', sans-serif; background: #02010a; color: white; min-height: 100vh; overflow-x: hidden; }

        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.3; z-index: -1; animation: moveStars 120s linear infinite; }
        @keyframes moveStars { from {background-position: 0 0;} to {background-position: 1000px 1000px;} }

        /* UI Base */
        header { background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); padding: 15px 8%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 1000; }
        .nav-link { color: #888; text-decoration: none; font-weight: bold; cursor: pointer; margin: 0 15px; font-size: 0.8rem; text-transform: uppercase; }
        .nav-link.active { color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 5px; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        /* Filtros de Categoria */
        .cat-bar { display: flex; gap: 10px; margin-bottom: 30px; overflow-x: auto; padding: 10px 0; }
        .cat-btn { background: var(--glass); border: 1px solid #333; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .cat-btn.active { background: var(--primary); color: #000; font-weight: bold; }

        /* Loja */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { background: var(--glass); border: 1px solid #222; border-radius: 12px; padding: 20px; text-align: center; backdrop-filter: blur(10px); }
        .card:hover { border-color: var(--primary); transform: translateY(-5px); }

        /* Comunidade Estilo Chat */
        .chat-container { height: 500px; display: flex; flex-direction: column; background: rgba(0,0,0,0.4); border-radius: 15px; border: 1px solid #222; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .chat-msg { max-width: 80%; padding: 10px 15px; border-radius: 12px; position: relative; font-size: 0.9rem; }
        .msg-me { align-self: flex-end; background: var(--secondary); }
        .msg-others { align-self: flex-start; background: #333; }
        .msg-user { font-size: 0.7rem; color: var(--primary); font-weight: bold; margin-bottom: 4px; display: block; }
        .msg-time { font-size: 0.6rem; opacity: 0.5; display: block; text-align: right; }

        /* Admin Fullscreen */
        #admin-panel { display: none; background: #050505; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; overflow-y: auto; padding: 40px; }
        .admin-grid { display: grid; grid-template-columns: 300px 1fr; gap: 40px; }
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 10px; justify-content: center; }
        .btn-p { background: var(--primary); color: #000; }
        .btn-s { background: var(--secondary); color: white; }
        
        input, select { background: #111; border: 1px solid #333; color: white; padding: 12px; border-radius: 6px; width: 100%; margin-bottom: 10px; }

        #notif { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
        .toast { background: #111; border-left: 5px solid var(--primary); padding: 15px 25px; margin-top: 10px; animation: slideIn 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(120%); } to { transform: translateX(0); } }

        section { display: none; }
        section.active { display: block; }
    </style>
</head>
<body>

<div class="stars"></div>
<div id="notif"></div>

<header>
    <div style="font-weight:900; font-size:1.2rem;">QUEBREI O <span style="color:var(--primary)">SISTEMA</span></div>
    <nav>
        <a class="nav-link active" onclick="tab('store')">Loja</a>
        <a class="nav-link" onclick="tab('chat')">Comunidade</a>
        <a class="nav-link" onclick="tab('support')">Suporte</a>
    </nav>
    <div id="user-area">
        <button class="btn btn-s" onclick="login()">LOGIN</button>
    </div>
</header>

<div class="container">
    <section id="store" class="active">
        <div class="cat-bar" id="cat-bar">
            <button class="cat-btn active" onclick="filterCat('all')">Tudo</button>
        </div>
        <div id="store-grid" class="grid"></div>
    </section>

    <section id="chat">
        <div class="chat-container">
            <div id="chat-msgs" class="chat-messages"></div>
            <div style="padding: 15px; background: rgba(0,0,0,0.5); display: flex; gap: 10px;">
                <input type="text" id="msg-input" placeholder="Escreva aqui...">
                <button class="btn btn-p" onclick="sendMsg()">ENVIAR</button>
            </div>
        </div>
    </section>

    <section id="support">
        <div class="card" style="max-width: 500px; margin: auto;">
            <i class="fas fa-ticket-alt fa-2x" style="color:var(--primary)"></i>
            <h2 style="margin: 15px 0">Abrir Ticket</h2>
            <input type="text" id="tk-title" placeholder="Assunto">
            <textarea id="tk-msg" placeholder="Detalhes do seu problema..." style="width:100%; background:#111; border:1px solid #333; color:white; padding:10px; height:100px; border-radius:6px;"></textarea>
            <button class="btn btn-p" style="width:100%; margin-top:10px;" onclick="openTicket()">ENVIAR TICKET</button>
        </div>
    </section>
</div>

<div id="admin-panel">
    <div style="display:flex; justify-content:space-between; margin-bottom:40px;">
        <h1>Dashboard Admin</h1>
        <button class="btn btn-s" style="background:red" onclick="closeAdm()">FECHAR PAINEL</button>
    </div>

    <div class="admin-grid">
        <div class="card">
            <h3>Categorias</h3>
            <input type="text" id="new-cat" placeholder="Nova Categoria">
            <button class="btn btn-p" onclick="addCat()">ADICIONAR</button>
            <div id="adm-cats" style="margin-top:20px;"></div>
        </div>

        <div class="card">
            <h3>Gerenciar Produtos</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                <input type="text" id="p-name" placeholder="Nome">
                <input type="number" id="p-price" placeholder="PreÃ§o">
                <input type="text" id="p-img" placeholder="Link da Imagem">
                <select id="p-cat-sel"></select>
            </div>
            <button class="btn btn-p" style="width:100%" onclick="saveProd()">CADASTRAR PRODUTO</button>
            
            <div id="adm-prods" class="grid" style="margin-top:30px;"></div>
        </div>
    </div>
</div>

<footer style="text-align:center; padding:50px; opacity:0.1; cursor:pointer;" onclick="checkAdm()">ADMIN</footer>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYzx7TPmAghFcGuKYzBDIYRW0SjrMJ_r8",
        authDomain: "quebrei-o-sistema.firebaseapp.com",
        databaseURL: "https://quebrei-o-sistema-default-rtdb.firebaseio.com",
        projectId: "quebrei-o-sistema",
        appId: "1:133672006102:web:e62c681ced44b3650f7477"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let user = null;

    function toast(m) {
        const t = document.createElement('div'); t.className='toast'; t.innerText=m;
        document.getElementById('notif').appendChild(t);
        setTimeout(()=>t.remove(), 3000);
    }

    function tab(id) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
    }

    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).then(res => {
            user = res.user;
            document.getElementById('user-area').innerHTML = `<img src="${user.photoURL}" style="width:35px; border-radius:50%; border:2px solid var(--primary)">`;
            toast("Bem-vindo!");
        });
    }

    function checkAdm() {
        const p = prompt("Chave:");
        if(p === "270712") document.getElementById('admin-panel').style.display='block';
    }
    function closeAdm() { document.getElementById('admin-panel').style.display='none'; }

    // --- CATEGORIAS ---
    function addCat() {
        const n = document.getElementById('new-cat').value;
        if(n) db.ref('categorias').push(n);
        document.getElementById('new-cat').value = "";
    }

    db.ref('categorias').on('value', snap => {
        const bar = document.getElementById('cat-bar');
        const sel = document.getElementById('p-cat-sel');
        const list = document.getElementById('adm-cats');
        bar.innerHTML = '<button class="cat-btn active" onclick="filterCat(\'all\')">Tudo</button>';
        sel.innerHTML = '<option value="">Sem Categoria</option>';
        list.innerHTML = "";
        snap.forEach(c => {
            const name = c.val();
            bar.innerHTML += `<button class="cat-btn" onclick="filterCat('${name}')">${name}</button>`;
            sel.innerHTML += `<option value="${name}">${name}</option>`;
            list.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>${name}</span><i class="fas fa-trash" onclick="db.ref('categorias/${c.key}').remove()"></i></div>`;
        });
    });

    // --- PRODUTOS ---
    function saveProd() {
        db.ref('produtos').push({
            name: document.getElementById('p-name').value,
            price: document.getElementById('p-price').value,
            img: document.getElementById('p-img').value,
            cat: document.getElementById('p-cat-sel').value
        });
        toast("Salvo!");
    }

    function filterCat(cat) {
        renderStore(cat);
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    }

    function renderStore(f = 'all') {
        db.ref('produtos').once('value', snap => {
            const grid = document.getElementById('store-grid');
            const adm = document.getElementById('adm-prods');
            grid.innerHTML = ""; adm.innerHTML = "";
            snap.forEach(c => {
                const p = c.val();
                if(f === 'all' || p.cat === f) {
                    grid.innerHTML += `<div class="card">
                        ${p.img ? `<img src="${p.img}" style="width:100%; height:120px; object-fit:contain">` : 'ðŸ“¦'}
                        <h4>${p.name}</h4><p>R$ ${p.price}</p>
                        <button class="btn btn-s" style="width:100%" onclick="toast('Adicionado!')">COMPRAR</button>
                    </div>`;
                }
                adm.innerHTML += `<div class="card"><b>${p.name}</b><br><button onclick="db.ref('produtos/${c.key}').remove()">Excluir</button></div>`;
            });
        });
    }
    db.ref('produtos').on('value', () => renderStore());

    // --- COMUNIDADE ---
    function sendMsg() {
        if(!user) return toast("Login necessÃ¡rio para falar!");
        const txt = document.getElementById('msg-input').value;
        if(txt) {
            db.ref('chat').push({
                u: user.displayName,
                m: txt,
                uid: user.uid,
                t: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });
            document.getElementById('msg-input').value = "";
        }
    }

    db.ref('chat').limitToLast(20).on('value', snap => {
        const box = document.getElementById('chat-msgs');
        box.innerHTML = "";
        snap.forEach(c => {
            const d = c.val();
            const isMe = user && d.uid === user.uid;
            box.innerHTML += `<div class="chat-msg ${isMe ? 'msg-me' : 'msg-others'}">
                <span class="msg-user">${d.u}</span>
                ${d.m}
                <span class="msg-time">${d.t}</span>
            </div>`;
        });
        box.scrollTop = box.scrollHeight;
    });

    function openTicket() {
        if(!user) return toast("Login necessÃ¡rio!");
        db.ref('tickets').push({ u: user.displayName, t: document.getElementById('tk-title').value, m: document.getElementById('tk-msg').value });
        toast("Ticket enviado!");
    }

    AOS.init();
</script>
</body>
</html>
