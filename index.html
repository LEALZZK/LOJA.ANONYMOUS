<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUEBREI O SISTEMA - Ultra Hub</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root { 
            --primary: #00ff88; --secondary: #007bff; --bg: #0a0a0a; 
            --card-bg: #151515; --text: #ffffff; --discord: #5865F2; 
        }

        * { transition: all 0.3s ease; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }

        /* HEADER */
        header { 
            background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px); padding: 15px 5%; 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 2px solid var(--secondary); position: sticky; top: 0; z-index: 1000;
        }
        .logo-text { font-weight: 900; text-transform: uppercase; font-size: 1.2rem; letter-spacing: 2px; margin: 0; }
        .logo-text span { color: var(--secondary); text-shadow: 0 0 10px var(--secondary); }

        nav a { color: #888; text-decoration: none; margin-left: 15px; text-transform: uppercase; font-size: 0.75rem; font-weight: bold; cursor: pointer; }
        nav a:hover, nav a.active { color: var(--primary); }

        /* AVISOS FLASH */
        #news-bar { background: linear-gradient(90deg, #000, var(--secondary), #000); padding: 8px; text-align: center; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; overflow: hidden; }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* COMUNIDADE / CHAT */
        #chat-container { background: #111; border-radius: 15px; border: 1px solid #222; height: 500px; display: flex; flex-direction: column; }
        #chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .chat-msg { background: #222; padding: 10px 15px; border-radius: 10px; max-width: 80%; width: fit-content; border-left: 3px solid var(--secondary); }
        .chat-msg b { color: var(--primary); font-size: 0.8rem; display: block; }
        .chat-input-area { padding: 15px; display: flex; gap: 10px; background: #0a0a0a; border-radius: 0 0 15px 15px; }

        /* TICKETS */
        .ticket-card { background: var(--card-bg); border: 1px solid var(--primary); padding: 20px; border-radius: 12px; margin-top: 20px; }

        /* UI ELEMENTS */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
        .card { background: var(--card-bg); border-radius: 15px; padding: 20px; border: 1px solid #222; text-align: center; }
        .card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .btn { padding: 10px 20px; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; }
        .btn-buy { background: var(--secondary); color: white; width: 100%; }
        
        input, textarea, select { background: #000; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; margin: 5px 0; width: 100%; outline: none; }
        
        #notif-box { position: fixed; top: 20px; left: 20px; z-index: 10000; }
        .toast { background: #1a1a1a; color: var(--primary); border-left: 5px solid var(--primary); padding: 12px 20px; margin-bottom: 10px; border-radius: 5px; animation: slideIn 0.4s; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }

        section { display: none; }
        section.active { display: block; }

        /* ADMIN */
        #admin-view { display: none; padding: 40px; background: #050505; min-height: 100vh; }
        .admin-section { background: #111; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #333; }
    </style>
</head>
<body>

<div id="notif-box"></div>

<div id="news-bar"><span id="news-text">Aguardando novos avisos da staff...</span></div>

<header>
    <div class="logo-area">
        <h1 class="logo-text" onclick="showSection('shop')">QUEBREI O <span>SISTEMA</span></h1>
    </div>
    <nav>
        <a id="nav-shop" class="active" onclick="showSection('shop')">Loja</a>
        <a id="nav-chat" onclick="showSection('chat')">Comunidade</a>
        <a id="nav-ticket" onclick="showSection('ticket')">Suporte</a>
        <a id="nav-reviews" onclick="showSection('reviews')">Avalia√ß√µes</a>
        <button class="btn" style="background:var(--secondary); color:white; font-size:0.7rem;" onclick="openCart()">üõí (<span id="cart-count">0</span>)</button>
    </nav>
</header>

<div class="container">
    <section id="shop" class="active" data-aos="fade-up">
        <div id="shop-content"></div>
    </section>

    <section id="chat" data-aos="fade-in">
        <h2 class="cat-title">COMUNIDADE ONLINE</h2>
        <div id="chat-container">
            <div id="chat-messages"></div>
            <div class="chat-input-area">
                <input type="text" id="chat-nick" placeholder="Seu Nick" style="width: 30%">
                <input type="text" id="chat-msg" placeholder="Digite sua mensagem...">
                <button class="btn btn-buy" style="width: auto" onclick="sendChat()">ENVIAR</button>
            </div>
        </div>
    </section>

    <section id="ticket" data-aos="zoom-in">
        <div class="ticket-card">
            <h3>üé´ ABRIR TICKET DE SUPORTE</h3>
            <p>Seu ticket ser√° visualizado diretamente pela staff.</p>
            <input type="text" id="tk-discord" placeholder="Seu Discord">
            <select id="tk-subject">
                <option value="D√∫vida">D√∫vida</option>
                <option value="Problema com Compra">Problema com Compra</option>
                <option value="Den√∫ncia">Den√∫ncia</option>
            </select>
            <textarea id="tk-text" placeholder="Descreva o que aconteceu..."></textarea>
            <button class="btn btn-buy" onclick="createTicket()">ENVIAR TICKET</button>
        </div>
    </section>

    <section id="reviews">
        <h2 class="cat-title">O QUE DIZEM DE N√ìS</h2>
        <div id="reviews-list"></div>
        <div class="card" style="text-align: left; margin-top:30px;">
            <h3>Deixe seu feedback</h3>
            <input type="text" id="rev-nick" placeholder="Nick">
            <textarea id="rev-msg" placeholder="Sua opini√£o..."></textarea>
            <button class="btn btn-buy" onclick="sendReview()">PUBLICAR</button>
        </div>
    </section>
</div>

<div id="admin-view">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>‚öôÔ∏è PAINEL DE CONTROLE</h2>
        <button class="btn" style="background:red; color:white" onclick="location.reload()">SAIR</button>
    </div>

    <div class="admin-section">
        <h3>üì¢ Sistema de Avisos</h3>
        <input type="text" id="adm-news" placeholder="Texto do aviso que aparecer√° no topo">
        <button class="btn btn-buy" onclick="updateNews()">ATUALIZAR AVISO</button>
    </div>

    <div class="admin-section">
        <h3>üé´ Tickets de Suporte</h3>
        <div id="adm-tickets-list"></div>
    </div>

    <div class="admin-section">
        <h3>üì¶ Produtos & Categorias</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <input type="text" id="new-cat" placeholder="Nova Categoria">
            <button class="btn btn-buy" onclick="addCat()">ADICIONAR CAT</button>
        </div>
        <hr style="opacity:0.1; margin:15px 0">
        <input type="text" id="p-name" placeholder="Nome">
        <input type="number" id="p-price" placeholder="Pre√ßo">
        <input type="text" id="p-img" placeholder="Link Imagem">
        <select id="p-cat-select"></select>
        <button class="btn btn-buy" onclick="saveProduct()">CADASTRAR PRODUTO</button>
    </div>
</div>

<footer style="padding:60px; text-align:center; opacity:0.1; cursor:pointer" onclick="openAdmin()">ADMIN</footer>

<script>
    AOS.init();
    const firebaseConfig = {
        apiKey: "AIzaSyCYzx7TPmAghFcGuKYzBDIYRW0SjrMJ_r8",
        authDomain: "quebrei-o-sistema.firebaseapp.com",
        databaseURL: "https://quebrei-o-sistema-default-rtdb.firebaseio.com",
        projectId: "quebrei-o-sistema",
        appId: "1:133672006102:web:e62c681ced44b3650f7477"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let cart = [];

    function pushNotif(m) {
        const t = document.createElement('div'); t.className='toast'; t.innerText=m;
        document.getElementById('notif-box').appendChild(t); setTimeout(()=>t.remove(), 4000);
    }

    function showSection(id) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('nav-'+id).classList.add('active');
        AOS.refresh();
    }

    // --- SISTEMA DE AVISOS ---
    db.ref('config/aviso').on('value', snap => {
        document.getElementById('news-text').innerText = snap.val() || "Bem-vindo √† Quebrei o Sistema!";
    });

    function updateNews() {
        const txt = document.getElementById('adm-news').value;
        db.ref('config').update({aviso: txt});
        pushNotif("Aviso atualizado!");
    }

    // --- COMUNIDADE (CHAT) ---
    function sendChat() {
        const nick = document.getElementById('chat-nick').value || "An√¥nimo";
        const msg = document.getElementById('chat-msg').value;
        if(msg) {
            db.ref('chat').push({nick, msg, time: new Date().toLocaleTimeString()});
            document.getElementById('chat-msg').value = "";
        }
    }

    db.ref('chat').limitToLast(15).on('value', snap => {
        const cont = document.getElementById('chat-messages');
        cont.innerHTML = "";
        snap.forEach(c => {
            const d = c.val();
            cont.innerHTML += `<div class="chat-msg"><b>${d.nick}</b>${d.msg}</div>`;
        });
        cont.scrollTop = cont.scrollHeight;
    });

    // --- TICKETS ---
    function createTicket() {
        const disc = document.getElementById('tk-discord').value;
        const sub = document.getElementById('tk-subject').value;
        const msg = document.getElementById('tk-text').value;
        if(disc && msg) {
            db.ref('tickets').push({disc, sub, msg, status: 'Aberto', date: new Date().toLocaleString()});
            pushNotif("Ticket aberto! Staff entrar√° em contato.");
            document.getElementById('tk-text').value = "";
        }
    }

    // --- ADMIN ---
    function openAdmin() {
        if(prompt("Senha:") === "270712") {
            document.querySelector('header').style.display='none';
            document.querySelector('.container').style.display='none';
            document.getElementById('admin-view').style.display='block';
            loadAdmin();
        }
    }

    function loadAdmin() {
        // Render Tickets
        db.ref('tickets').on('value', snap => {
            const list = document.getElementById('adm-tickets-list');
            list.innerHTML = "";
            snap.forEach(t => {
                const d = t.val();
                list.innerHTML += `<div style="background:#222; padding:10px; margin-bottom:5px; border-radius:5px">
                    <b>[${d.sub}] ${d.disc}</b>: ${d.msg} 
                    <button onclick="db.ref('tickets/${t.key}').remove()" style="background:red; border:none; color:white; padding:3px 8px; float:right">X</button>
                </div>`;
            });
        });
    }

    // --- L√ìGICA DE PRODUTOS (SIMILAR AO ANTERIOR) ---
    db.ref('/').on('value', snap => {
        const data = snap.val() || {};
        renderShop(data.categorias, data.produtos);
        updateAdmSelectors(data.categorias);
    });

    function renderShop(cats, prods) {
        const cont = document.getElementById('shop-content');
        cont.innerHTML = "";
        for(let id in cats) {
            let catHtml = `<h2 style="border-left:4px solid var(--secondary); padding-left:10px; margin:40px 0 20px;">${cats[id].name}</h2><div class="grid">`;
            for(let pId in prods) {
                if(prods[pId].cat === cats[id].name) {
                    catHtml += `<div class="card">
                        <img src="${prods[pId].img || 'https://via.placeholder.com/150'}">
                        <h4>${prods[pId].name}</h4><p style="color:var(--primary)">R$ ${prods[pId].price}</p>
                        <button class="btn btn-buy" onclick="addToCart('${prods[pId].name}', ${prods[pId].price})">üõí ADICIONAR</button>
                    </div>`;
                }
            }
            catHtml += `</div>`;
            cont.innerHTML += catHtml;
        }
    }

    function addCat() {
        const n = document.getElementById('new-cat').value;
        if(n) db.ref('categorias').push({name: n});
    }

    function saveProduct() {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        const img = document.getElementById('p-img').value;
        const cat = document.getElementById('p-cat-select').value;
        if(name && price) db.ref('produtos').push({name, price, img, cat});
    }

    function updateAdmSelectors(cats) {
        const sel = document.getElementById('p-cat-select');
        if(sel) {
            sel.innerHTML = "";
            for(let id in cats) sel.innerHTML += `<option value="${cats[id].name}">${cats[id].name}</option>`;
        }
    }
    
    function addToCart(n, p) {
        cart.push({name:n, price:p});
        document.getElementById('cart-count').innerText = cart.length;
        pushNotif(n + " adicionado!");
    }

    function openCart() {
        if(cart.length === 0) return pushNotif("Carrinho vazio!");
        alert("Itens no carrinho:\n" + cart.map(i => i.name).join("\n") + "\n\nAbra um Ticket para finalizar a compra!");
        showSection('ticket');
    }
</script>
</body>
</html>
